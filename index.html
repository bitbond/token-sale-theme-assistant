<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Color Picker Form</title>
    <!-- Add Roboto font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #F7FAFF;
            margin: 0;
            padding: 20px;
        }
        .form-container {
            background-color: #FFFFFF;
            padding: 20px;
            border: 1px solid #E8F0FF;
            border-radius: 8px;
            max-width: 800px;
            margin: 0 auto 20px auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .form-group label {
            flex: 1;
            font-weight: 500;
        }
        .form-group input[type="color"],
        .form-group input[type="text"],
        .form-group input[type="number"] {
            flex: 2;
            padding: 5px;
            margin-left: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .url-preview {
            background-color: #f3f3f3;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            word-break: break-all;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .url-preview input {
            border: none;
            background: transparent;
            flex: 1;
            margin-right: 10px;
            font-family: monospace;
            height: 40px; /* Increased height to display full URL */
        }
        .copy-button {
            padding: 5px 10px;
            background-color: #03A9F4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .copy-button:hover {
            background-color: #0288D1;
        }
        iframe {
            width: 100%;
            height: 1000px;
            border: 0;
        }
        @media (max-width: 600px) {
            .form-group {
                flex-direction: column;
                align-items: flex-start;
            }
            .form-group input[type="color"],
            .form-group input[type="text"],
            .form-group input[type="number"] {
                margin-left: 0;
                margin-top: 5px;
                width: 100%;
            }
            .url-preview {
                flex-direction: column;
                align-items: stretch;
            }
            .copy-button {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <form id="colorForm">
            <!-- Added Token Sale Address Field -->
            <div class="form-group">
                <label for="tokenSaleAddress">Token Sale Address:</label>
                <input type="text" id="tokenSaleAddress" name="tokenSaleAddress" value="" placeholder="Enter Token Sale Address">
            </div>
            <!-- Added Chain ID Field -->
            <div class="form-group">
                <label for="chainId">Chain ID:</label>
                <input type="number" id="chainId" name="chainId" value="" placeholder="Enter Chain ID">
            </div>
            <!-- Existing Color Fields -->
            <div class="form-group">
                <label for="bgColorPrimary">Background Color Primary:</label>
                <input type="color" id="bgColorPrimary" name="bgColorPrimary" value="#F7FAFF">
                <input type="text" id="bgColorPrimaryHex" name="bgColorPrimaryHex" value="#F7FAFF" maxlength="7" pattern="#[0-9a-fA-F]{6}">
            </div>
            <div class="form-group">
                <label for="bgColorSecondary">Background Color Secondary:</label>
                <input type="color" id="bgColorSecondary" name="bgColorSecondary" value="#FFFFFF">
                <input type="text" id="bgColorSecondaryHex" name="bgColorSecondaryHex" value="#FFFFFF" maxlength="7" pattern="#[0-9a-fA-F]{6}">
            </div>
            <div class="form-group">
                <label for="borderColor">Border Color:</label>
                <input type="color" id="borderColor" name="borderColor" value="#E8F0FF">
                <input type="text" id="borderColorHex" name="borderColorHex" value="#E8F0FF" maxlength="7" pattern="#[0-9a-fA-F]{6}">
            </div>
            <div class="form-group">
                <label for="ctaPrimary">CTA Primary:</label>
                <input type="color" id="ctaPrimary" name="ctaPrimary" value="#03A9F4">
                <input type="text" id="ctaPrimaryHex" name="ctaPrimaryHex" value="#03A9F4" maxlength="7" pattern="#[0-9a-fA-F]{6}">
            </div>
            <div class="form-group">
                <label for="ctaFontColor">CTA Font Color:</label>
                <input type="color" id="ctaFontColor" name="ctaFontColor" value="#FFFFFF">
                <input type="text" id="ctaFontColorHex" name="ctaFontColorHex" value="#000000" maxlength="7" pattern="#[0-9a-fA-F]{6}">
            </div>
            <div class="form-group">
                <label for="fontColorPrimary">Font Color Primary:</label>
                <input type="color" id="fontColorPrimary" name="fontColorPrimary" value="#000000">
                <input type="text" id="fontColorPrimaryHex" name="fontColorPrimaryHex" value="#000000" maxlength="7" pattern="#[0-9a-fA-F]{6}">
            </div>
            <div class="form-group">
                <label for="fontColorSecondary">Font Color Secondary:</label>
                <input type="color" id="fontColorSecondary" name="fontColorSecondary" value="#6B7483">
                <input type="text" id="fontColorSecondaryHex" name="fontColorSecondaryHex" value="#6B7483" maxlength="7" pattern="#[0-9a-fA-F]{6}">
            </div>
        </form>
        <div class="url-preview">
            <input type="text" id="urlPreview" readonly>
            <button class="copy-button" onclick="copyURL()">Copy</button>
        </div>

        <!-- Added Message for Missing Parameters -->
        <div id="missingParamsMessage" style="display: none; color: red; text-align: center;">
            Provide Token Sale Address and Chain ID to preview the token sale.
        </div>
    </div>

    <iframe id="iframePreview" src="https://pr-769.pr.tokentool.bitbond.net/tokensale/0x7abb1d0a604d611914968b15b3803a6c08051a86?chainId=80002&bgColorPrimary=F7FAFF&bgColorSecondary=FFFFFF&fontColorPrimary=000000&fontColorSecondary=6B7483&borderColor=E8F0FF&ctaPrimary=03A9F4&ctaFontColor=000000&previewAllStates=true" width="100%" height="1000px" frameborder="0" name="tokensale"></iframe>

    <script>
        const form = document.getElementById('colorForm');
        const iframe = document.getElementById('iframePreview');
        const urlPreview = document.getElementById('urlPreview');
        const missingParamsMessage = document.getElementById('missingParamsMessage'); // Added

        const baseDomain = 'https://pr-769.pr.tokentool.bitbond.net/tokensale';

        function getURLParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                tokenSaleAddress: params.get('tokenSaleAddress') || '',
                chainId: params.get('chainId') || ''
            };
        }

        function updateIframe() {
            const params = new URLSearchParams();

            // Get Token Sale Address and Chain ID
            const tokenSaleAddress = document.getElementById('tokenSaleAddress').value.trim();
            const chainId = document.getElementById('chainId').value.trim();

            // Check if both parameters are provided
            if (tokenSaleAddress && chainId) {
                params.set('chainId', chainId);
                params.set('previewAllStates', 'true');

                // Get color fields
                const colorFields = [
                    'bgColorPrimary',
                    'bgColorSecondary',
                    'borderColor',
                    'ctaPrimary',
                    'ctaFontColor',
                    'fontColorPrimary',
                    'fontColorSecondary'
                ];

                colorFields.forEach(field => {
                    const color = document.getElementById(field).value.substring(1).toUpperCase();
                    params.set(field, color);
                });

                const newSrc = `${baseDomain}/${tokenSaleAddress}?${params.toString()}`;
                iframe.src = newSrc;
                urlPreview.value = newSrc;

                // Show iframe and hide message
                iframe.style.display = 'block';
                missingParamsMessage.style.display = 'none';
            } else {
                // Hide iframe and show message
                iframe.style.display = 'none';
                missingParamsMessage.style.display = 'block';
                urlPreview.value = '';
            }
        }

        function copyURL() {
            const copyText = urlPreview.value;
            if (copyText) {
                navigator.clipboard.writeText(copyText).then(() => {
                    alert('URL copied to clipboard!');
                }, () => {
                    alert('Failed to copy URL.');
                });
            }
        }

        // Sync color picker and hex input
        function syncField(field) {
            const colorInput = document.getElementById(field);
            const hexInput = document.getElementById(field + 'Hex');

            colorInput.addEventListener('input', () => {
                hexInput.value = colorInput.value.toUpperCase();
                updateIframe();
            });

            hexInput.addEventListener('input', () => {
                let value = hexInput.value;
                if (!value.startsWith('#')) {
                    value = '#' + value;
                }
                if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
                    colorInput.value = value;
                    updateIframe();
                }
            });
        }

        // Sync Token Sale Address and Chain ID
        function syncSpecialField(field) {
            const input = document.getElementById(field);

            input.addEventListener('input', () => {
                updateIframe();
            });
        }

        // Initialize form with URL parameters
        window.addEventListener('DOMContentLoaded', () => {
            const { tokenSaleAddress, chainId } = getURLParams();
            document.getElementById('tokenSaleAddress').value = tokenSaleAddress;
            document.getElementById('chainId').value = chainId;

            // Initialize color fields
            const colorFields = [
                'bgColorPrimary',
                'bgColorSecondary',
                'borderColor',
                'ctaPrimary',
                'ctaFontColor',
                'fontColorPrimary',
                'fontColorSecondary'
            ];

            colorFields.forEach(syncField);

            // Initialize Token Sale Address and Chain ID fields
            const specialFields = ['tokenSaleAddress', 'chainId'];
            specialFields.forEach(syncSpecialField);

            // Initialize URL preview and iframe
            updateIframe();
        });
    </script>
</body>
</html>
